<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Terms Quiz</title>
    <style>
        :root {
            --primary: #4A90E2;
            --success: #2ECC71;
            --error: #E74C3C;
            --bg: #f5f7fa;
            --card: #ffffff;
            --text: #2c3e50;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            padding-bottom: 50px; /* Space for footer */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            background: var(--card);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            padding: 30px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        h1 { margin-bottom: 10px; font-size: 28px; color: var(--primary); }
        .subtitle { color: #7f8c8d; margin-bottom: 30px; font-size: 16px; }
        
        .mode-select button, .option-btn, .next-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.1s, opacity 0.2s;
            width: 100%;
            max-width: 300px;
        }

        .mode-select button:hover { transform: translateY(-2px); }
        
        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            color: var(--text);
            margin-bottom: 10px;
            text-align: left;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .option-btn:hover { border-color: var(--primary); background: #f0f7ff; }
        .option-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .option-btn.wrong { background: var(--error); color: white; border-color: var(--error); }

        .quiz-area { display: none; }
        
        .term-container {
            margin: 20px 0;
        }

        .term-display {
            font-size: 32px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .term-ipa {
            display: block;
            font-size: 16px;
            color: #7f8c8d;
            font-family: "Lucida Sans Unicode", "Arial Unicode MS", sans-serif;
            margin-top: 5px;
            font-weight: normal;
        }

        .audio-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.2s;
            text-decoration: none;
        }
        .audio-btn:hover { opacity: 1; transform: scale(1.1); }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
            display: none;
            text-align: left;
            border-left: 5px solid #ccc;
        }

        .feedback.show { display: block; }
        .feedback.success { border-left-color: var(--success); }
        .feedback.error { border-left-color: var(--error); }

        /* Pinyin Styling */
        .pronunciation-guide {
            margin-top: 10px;
            font-size: 14px;
            color: #555;
            background: #eee;
            padding: 8px;
            border-radius: 5px;
        }
        .pinyin-row { display: flex; gap: 10px; margin-bottom: 2px; }
        .pinyin-label { font-weight: bold; color: #888; width: 40px; }

        .stats {
            margin-top: 20px;
            font-size: 14px;
            color: #7f8c8d;
            display: flex;
            justify-content: space-between;
        }

        .hidden { display: none; }

        /* Footer Signature */
        .footer-credit {
            position: fixed;
            bottom: 5px;
            left: 0;
            width: 100%;
            text-align: center;
            color: #d1d5db; /* Ê•µÊ∑°ÁÅ∞Ëâ≤ */
            font-size: 11px; /* Ê•µÂ∞èÂ≠óÈ´î */
            z-index: 0; /* Á¢∫‰øù‰∏çÊìã‰ΩèÊìç‰Ωú */
            pointer-events: none; /* ÈªûÊìäÁ©øÈÄè */
            font-family: sans-serif;
            letter-spacing: 1px;
        }

    </style>
</head>
<body>

<div class="container" id="app">
    <div id="start-screen">
        <h1>Music Terms Quiz</h1>
        <p class="subtitle">Italian, German & French Terms</p>
        
        <div class="mode-select">
            <button onclick="startQuiz('zh')">‰∏≠ÊñáÊ®°Âºè (Chinese Mode)</button>
            <button onclick="startQuiz('en')">English Mode</button>
        </div>
        <div style="margin-top: 30px; font-size: 13px; color: #999; line-height: 1.6;">
            üí° ÈªûÊìä <span style="font-size:16px">üîä</span> ÂúñÁ§∫ÂèØÈñãÂïüÁôºÈü≥Ë¶ñÁ™ó<br>
            (Pop-up window for pronunciation)
        </div>
    </div>

    <div id="quiz-screen" class="quiz-area">
        <div class="stats">
            <span id="score-display">Score: 0</span>
            <span id="progress-display">Q: 1 / ‚àû</span>
        </div>

        <div class="term-container">
            <div class="term-display">
                <span id="question-term">Loading...</span>
                <button onclick="playAudio()" class="audio-btn" title="Open Google Translate Audio">üîä</button>
            </div>
            <span id="question-ipa" class="term-ipa"></span>
        </div>

        <div id="options-container">
            </div>

        <div id="feedback-area" class="feedback">
            <h3 id="feedback-title"></h3>
            <div id="feedback-content"></div>
            
            <div id="pronunciation-box" class="pronunciation-guide hidden">
                <div class="pinyin-row">
                    <span class="pinyin-label">Á≤µ:</span>
                    <span id="canto-text"></span>
                </div>
                <div class="pinyin-row">
                    <span class="pinyin-label">ÊôÆ:</span>
                    <span id="mando-text"></span>
                </div>
            </div>
        </div>

        <button id="next-btn" class="next-btn hidden" onclick="nextQuestion()">Next Question</button>
        <button class="next-btn" style="background:#95a5a6; margin-top:20px;" onclick="location.reload()">Menu</button>
    </div>
</div>

<div class="footer-credit">
    Ë±êÁãÇÂá∫ÂìÅ ‚Ä¢ Ê®ÇÁêÜÈö®Ë∫´ËÅΩ
</div>

<script>
    /* Data Structure Update:
       ipa: International Phonetic Alphabet for the music term
       canto: Cantonese Romanization (Jyutping approx) for the CHINESE DEFINITION
       mando: Mandarin Romanization (Pinyin approx) for the CHINESE DEFINITION
    */
    const musicTerms = [
        // ÁØÑ‰æãÔºöÂÆåÊï¥Ë≥áÊñôÁöÑÂâçÂπæÈ†Ö (ÊÇ®ÂèØ‰ª•Âú®Ê≠§‰æùÁÖßÊ†ºÂºèË£úÂÖÖÊõ¥Â§ö)
        { term: "allegro", ipa: "/alÀàle.…°ro/", def: "Âø´Êùø", lang: "Italian", en: "Fast, lively", canto: "Faai Baan", mando: "Ku√†i B«én" },
        { term: "largo", ipa: "/Ààlar.…°o/", def: "Âª£Êùø", lang: "Italian", en: "Broad, slow", canto: "Gwong Baan", mando: "Gu«éng B«én" },
        { term: "adagio", ipa: "/aÀàda.d ío/", def: "ÊüîÊùø", lang: "Italian", en: "Slow", canto: "Jau Baan", mando: "R√≥u B«én" },
        { term: "andante", ipa: "/anÀàdan.te/", def: "Ë°åÊùø", lang: "Italian", en: "Walking pace", canto: "Hang Baan", mando: "X√≠ng B«én" },
        { term: "presto", ipa: "/Ààpr…õs.to/", def: "ÊÄ•Êùø", lang: "Italian", en: "Very fast", canto: "Gap Baan", mando: "J√≠ B«én" },
        
        // ‰ª•‰∏ãÁÇ∫ÂÖ∂È§òÂñÆÂ≠ó (Â∑≤Ëá™ÂãïÂä†‰∏äÂü∫Êú¨ÁµêÊßãÔºåËã•ÈúÄÈ°ØÁ§∫Á≤µ/ÊôÆÊãºÈü≥ÈúÄÊâãÂãïË£úÂÖÖ canto/mando Ê¨Ñ‰Ωç)
        { term: "langsam", ipa: "/Ààla≈ãzaÀêm/", def: "ÊÖ¢ÁöÑ", lang: "German", en: "Slow", canto: "Maan", mando: "M√†n" },
        { term: "lent", ipa: "/l…ëÃÉ/", def: "ÊÖ¢ÁöÑ", lang: "French", en: "Slow", canto: "Maan", mando: "M√†n" },
        { term: "lento", ipa: "/Ààl…õn.to/", def: "ÊÖ¢Êùø", lang: "Italian", en: "Slow", canto: "Maan Baan", mando: "M√†n B«én" },
        { term: "larghetto", ipa: "/larÀà…°et.to/", def: "Â∞èÂª£Êùø", lang: "Italian", en: "Rather broad", canto: "Siu Gwong Baan", mando: "Xi«éo Gu«éng B«én" },
        { term: "andantino", ipa: "/an.danÀàti.no/", def: "Â∞èË°åÊùø", lang: "Italian", en: "Slightly faster/slower than Andante", canto: "Siu Hang Baan", mando: "Xi«éo X√≠ng B«én" },
        { term: "comodo", ipa: "/Ààk…î.mo.do/", def: "ËàíÈÅ©Âú∞", lang: "Italian", en: "Comfortable", canto: "Syv Sik", mando: "Sh≈´ Sh√¨" },
        { term: "mod√©r√©", ipa: "/m…î.de. Åe/", def: "‰∏≠Á≠âÁöÑ", lang: "French", en: "Moderate", canto: "Zung Dang", mando: "Zh≈çng Dƒõng" },
        { term: "m√§√üig", ipa: "/Ààm…õÀês…™√ß/", def: "ÈÅ©Â∫¶ÁöÑ", lang: "German", en: "Moderate", canto: "Sik Dou", mando: "Sh√¨ D√π" },
        { term: "meno mosso", ipa: "/Ààme.no Ààm…îs.so/", def: "Á®çÊÖ¢ (Âãï‰ΩúËºÉÂ∞ë)", lang: "Italian", en: "Less movement", canto: "Siu Dung Zok", mando: "ShƒÅo M√†n" },
        { term: "retenu", ipa: "/ Å…ô.t…ô.ny/", def: "Á™ÅÊÖ¢", lang: "French", en: "Held back", canto: "Dat Maan", mando: "T≈´ M√†n" },
        { term: "rubato", ipa: "/ruÀàba.to/", def: "ÂΩàÊÄßÈÄüÂ∫¶", lang: "Italian", en: "Robbed time", canto: "Taan Sing Cuk Dou", mando: "T√°n X√¨ng S√π D√π" },
        { term: "ritenuto", ipa: "/ri.teÀànu.to/", def: "Á™ÅÊÖ¢", lang: "Italian", en: "Held back", canto: "Dat Maan", mando: "T≈´ M√†n" },
        { term: "rallentando", ipa: "/ral.lenÀàtan.do/", def: "Êº∏ÊÖ¢", lang: "Italian", en: "Gradually slower", canto: "Zim Maan", mando: "Ji√†n M√†n" },
        { term: "ritardando", ipa: "/ri.tarÀàdan.do/", def: "Êº∏ÊÖ¢", lang: "Italian", en: "Gradually slower", canto: "Zim Maan", mando: "Ji√†n M√†n" },
        { term: "a tempo", ipa: "/a Ààt…õm.po/", def: "ÂõûÂéüÈÄü", lang: "Italian", en: "Back to original speed", canto: "Wui Jyun Cuk", mando: "Hu√≠ Yu√°n S√π" },
        { term: "allegretto", ipa: "/al.leÀà…°ret.to/", def: "Â∞èÂø´Êùø", lang: "Italian", en: "Fairly fast", canto: "Siu Faai Baan", mando: "Xi«éo Ku√†i B«én" },
        { term: "pi√π mosso", ipa: "/pju Ààm…îs.so/", def: "Á®çÂø´", lang: "Italian", en: "More movement", canto: "Saau Faai", mando: "ShƒÅo Ku√†i" },
        { term: "animato", ipa: "/a.niÀàma.to/", def: "ÁîüÂãïÂú∞", lang: "Italian", en: "Animated", canto: "Saang Dung", mando: "Shƒìng D√≤ng" },
        { term: "vivace", ipa: "/viÀàva.t Ée/", def: "ÁîöÂø´ / ÂÖÖÊªøÊ¥ªÂäõ", lang: "Italian", en: "Lively, quick", canto: "Sam Faai", mando: "Sh√®n Ku√†i" },
        { term: "schnell", ipa: "/ Én…õl/", def: "Âø´ÈÄüÂú∞", lang: "German", en: "Fast", canto: "Faai Cuk", mando: "Ku√†i S√π" },
        { term: "prestissimo", ipa: "/presÀàtis.si.mo/", def: "ÊúÄÊÄ•Êùø", lang: "Italian", en: "Very fast", canto: "Zeoi Gap Baan", mando: "Zu√¨ J√≠ B«én" },
        { term: "accelerando", ipa: "/at.t Ée.leÀàran.do/", def: "Êº∏Âø´", lang: "Italian", en: "Gradually faster", canto: "Zim Faai", mando: "Ji√†n Ku√†i" },
        { term: "da capo", ipa: "/da Ààka.po/", def: "ÂæûÈ†≠ÂÜçÂ•è", lang: "Italian", en: "From the beginning", canto: "Cung Tau", mando: "C√≥ng T√≥u" },
        { term: "fine", ipa: "/Ààfi.ne/", def: "ÁµêÊùü", lang: "Italian", en: "The end", canto: "Git Cuk", mando: "Ji√© Sh√π" },
        { term: "legato", ipa: "/leÀà…°a.to/", def: "ÂúìÊªëÂ•è", lang: "Italian", en: "Smoothly", canto: "Jyun Waat Zau", mando: "Yu√°n Hu√° Z√≤u" },
        { term: "staccato", ipa: "/stakÀàka.to/", def: "Êñ∑Â•è", lang: "Italian", en: "Detached", canto: "Dyun Zau", mando: "Du√†n Z√≤u" },
        { term: "forte", ipa: "/Ààf…îr.te/", def: "Âº∑", lang: "Italian", en: "Loud", canto: "Koeng", mando: "Qi√°ng" },
        { term: "piano", ipa: "/Ààpja.no/", def: "Âº±", lang: "Italian", en: "Soft", canto: "Joek", mando: "Ru√≤" },
        { term: "crescendo", ipa: "/kreÀà É…õn.do/", def: "Êº∏Âº∑", lang: "Italian", en: "Gradually louder", canto: "Zim Koeng", mando: "Ji√†n Qi√°ng" },
        { term: "diminuendo", ipa: "/di.mi.nuÀà…õn.do/", def: "Êº∏Âº±", lang: "Italian", en: "Gradually softer", canto: "Zim Joek", mando: "Ji√†n Ru√≤" },
        { term: "cantabile", ipa: "/kanÀàta.bi.le/", def: "Â¶ÇÊ≠åÂú∞", lang: "Italian", en: "Singing style", canto: "Jyu Go Dei", mando: "R√∫ Gƒì De" },
        { term: "dolce", ipa: "/Ààdol.t Ée/", def: "ÁîúÁæéÂú∞", lang: "Italian", en: "Sweet", canto: "Tim Mei", mando: "Ti√°n Mƒõi" },
        { term: "espressivo", ipa: "/es.presÀàsi.vo/", def: "ÂØåÊúâË°®ÊÉÖÂú∞", lang: "Italian", en: "Expressive", canto: "Fu Jau Biu Cing", mando: "F√π Y«íu Bi«éo Q√≠ng" },
        { term: "giocoso", ipa: "/d íoÀàko.zo/", def: "Ë©ºË´ßÂú∞", lang: "Italian", en: "Playful", canto: "Fui Haai", mando: "Huƒ´ Xi√©" },
        { term: "tranquillo", ipa: "/tranÀàkwil.lo/", def: "Âπ≥ÈùúÂú∞", lang: "Italian", en: "Calm", canto: "Ping Zing", mando: "P√≠ng J√¨ng" },
        { term: "maestoso", ipa: "/ma.eÀàsto.zo/", def: "ËéäÂö¥Âú∞", lang: "Italian", en: "Majestic", canto: "Zong Jim", mando: "ZhuƒÅng Y√°n" }
        // ... Ëã•ÊÇ®ÈúÄË¶ÅÂÖ∂È§òÂñÆÂ≠óÔºåÂèØÂ∞áÂÖàÂâçÁöÑÂàóË°®Ë≤ºÂõû‰∏¶Ë£ú‰∏äÁµêÊßã
    ];

    let currentMode = 'zh'; 
    let currentQuestion = null;
    let score = 0;
    let questionCount = 0;
    let isAnswering = true;

    function startQuiz(mode) {
        currentMode = mode;
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('quiz-screen').style.display = 'block';
        nextQuestion();
    }

    function getRandomItem(array) {
        return array[Math.floor(Math.random() * array.length)];
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function generateOptions(correctItem) {
        const options = [correctItem];
        while (options.length < 4) {
            const randomItem = getRandomItem(musicTerms);
            if (!options.includes(randomItem)) {
                options.push(randomItem);
            }
        }
        shuffleArray(options);
        return options;
    }

    // Google Translate Popup Logic
    function playAudio() {
        if(!currentQuestion) return;
        const term = encodeURIComponent(currentQuestion.term);
        // Opens a small popup window (width 400, height 500)
        const url = `https://translate.google.com/?sl=auto&text=${term}&op=translate`;
        window.open(url, 'googleTranslate', 'width=450,height=550,top=100,left=100,scrollbars=yes');
    }

    function nextQuestion() {
        isAnswering = true;
        questionCount++;
        document.getElementById('progress-display').textContent = `Q: ${questionCount}`;
        
        // Reset UI
        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('feedback-area').className = 'feedback';
        document.getElementById('feedback-area').style.display = 'none';
        document.getElementById('pronunciation-box').classList.add('hidden');
        
        // Select Question
        currentQuestion = getRandomItem(musicTerms);
        const options = generateOptions(currentQuestion);

        // Render Question
        document.getElementById('question-term').textContent = currentQuestion.term;
        
        // Render IPA if available
        const ipaEl = document.getElementById('question-ipa');
        ipaEl.textContent = currentQuestion.ipa ? `[ ${currentQuestion.ipa} ]` : '';

        // Render Options
        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            
            if (currentMode === 'zh') {
                btn.textContent = opt.def;
            } else {
                btn.textContent = opt.en;
            }

            btn.onclick = () => checkAnswer(opt, btn);
            optionsContainer.appendChild(btn);
        });
    }

    function checkAnswer(selectedOption, btnElement) {
        if (!isAnswering) return;
        isAnswering = false;

        const isCorrect = selectedOption.term === currentQuestion.term;
        const feedbackArea = document.getElementById('feedback-area');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackContent = document.getElementById('feedback-content');

        // Highlight buttons
        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(btn => {
            if ((currentMode === 'zh' && btn.textContent === currentQuestion.def) ||
                (currentMode === 'en' && btn.textContent === currentQuestion.en)) {
                btn.classList.add('correct');
            } else {
                btn.disabled = true;
            }
        });

        if (isCorrect) {
            score++;
            document.getElementById('score-display').textContent = `Score: ${score}`;
            btnElement.classList.add('correct');
            feedbackArea.classList.add('success');
            feedbackTitle.textContent = "Correct! Á≠îÂ∞ç‰∫ÜÔºÅ";
            feedbackTitle.style.color = "#2ECC71";
        } else {
            btnElement.classList.add('wrong');
            feedbackArea.classList.add('error');
            feedbackTitle.textContent = "Incorrect Á≠îÈåØ‰∫Ü";
            feedbackTitle.style.color = "#E74C3C";
        }

        feedbackContent.innerHTML = `
            <div style="font-size:1.1em; margin-bottom:5px;"><strong>${currentQuestion.term}</strong> (${currentQuestion.lang})</div>
            <div style="color:#555;">${currentQuestion.def}</div>
            <div style="color:#777; font-size:0.9em;">English: ${currentQuestion.en}</div>
        `;
        
        // Show Pronunciation Guide ONLY in Chinese Mode
        if(currentMode === 'zh') {
            const pBox = document.getElementById('pronunciation-box');
            const cText = document.getElementById('canto-text');
            const mText = document.getElementById('mando-text');
            
            if(currentQuestion.canto || currentQuestion.mando) {
                pBox.classList.remove('hidden');
                cText.textContent = currentQuestion.canto || '-';
                mText.textContent = currentQuestion.mando || '-';
            }
        }

        feedbackArea.style.display = 'block';
        document.getElementById('next-btn').classList.remove('hidden');
    }
</script>

</body>
</html>
