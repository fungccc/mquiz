<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music Terms Quiz</title>
    <style>
        :root {
            --primary: #4A90E2;
            --success: #2ECC71;
            --error: #E74C3C;
            --bg: #f5f7fa;
            --card: #ffffff;
            --text: #2c3e50;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            padding: 20px;
            padding-bottom: 50px; /* Space for footer */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
        }

        .container {
            background: var(--card);
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 100%;
            max-width: 600px;
            padding: 30px;
            text-align: center;
            position: relative;
            z-index: 1;
        }

        h1 { margin-bottom: 10px; font-size: 28px; color: var(--primary); }
        .subtitle { color: #7f8c8d; margin-bottom: 30px; font-size: 16px; }
        
        .mode-select button, .option-btn, .next-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.1s, opacity 0.2s;
            width: 100%;
            max-width: 300px;
        }

        .mode-select button:hover { transform: translateY(-2px); }
        
        .option-btn {
            background: white;
            border: 2px solid #e0e0e0;
            color: var(--text);
            margin-bottom: 10px;
            text-align: left;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .option-btn:hover { border-color: var(--primary); background: #f0f7ff; }
        .option-btn.correct { background: var(--success); color: white; border-color: var(--success); }
        .option-btn.wrong { background: var(--error); color: white; border-color: var(--error); }

        .quiz-area { display: none; }
        
        .term-container {
            margin: 20px 0;
        }

        .term-display {
            font-size: 32px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .term-ipa {
            display: block;
            font-size: 16px;
            color: #7f8c8d;
            font-family: "Lucida Sans Unicode", "Arial Unicode MS", sans-serif;
            margin-top: 5px;
            font-weight: normal;
        }

        .audio-btn {
            background: none;
            border: 2px solid #eee;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s;
            flex-shrink: 0;
        }
        .audio-btn:hover { background-color: #f0f0f0; transform: scale(1.1); }
        .audio-btn:active { background-color: #e0e0e0; transform: scale(0.95); }

        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
            display: none;
            text-align: left;
            border-left: 5px solid #ccc;
        }

        .feedback.show { display: block; }
        .feedback.success { border-left-color: var(--success); }
        .feedback.error { border-left-color: var(--error); }

        /* Pinyin Styling */
        .pronunciation-guide {
            margin-top: 10px;
            font-size: 14px;
            color: #555;
            background: #eee;
            padding: 8px;
            border-radius: 5px;
        }
        .pinyin-row { display: flex; gap: 10px; margin-bottom: 2px; }
        .pinyin-label { font-weight: bold; color: #888; width: 40px; flex-shrink: 0; }

        .stats {
            margin-top: 20px;
            font-size: 14px;
            color: #7f8c8d;
            display: flex;
            justify-content: space-between;
        }

        .hidden { display: none; }

        /* Footer Signature */
        .footer-credit {
            position: fixed;
            bottom: 5px;
            left: 0;
            width: 100%;
            text-align: center;
            color: #d1d5db; /* Ê•µÊ∑°ÁÅ∞Ëâ≤ */
            font-size: 11px; /* Ê•µÂ∞èÂ≠óÈ´î */
            z-index: 0; 
            pointer-events: none; /* ÈªûÊìäÁ©øÈÄè */
            font-family: sans-serif;
            letter-spacing: 1px;
        }

    </style>
</head>
<body>

<div class="container" id="app">
    <div id="start-screen">
        <h1>Music Terms Quiz</h1>
        <p class="subtitle">Italian, German & French Terms</p>
        
        <div class="mode-select">
            <button onclick="startQuiz('zh')">‰∏≠ÊñáÊ®°Âºè (Chinese Mode)</button>
            <button onclick="startQuiz('en')">English Mode</button>
        </div>
        <div style="margin-top: 30px; font-size: 13px; color: #999; line-height: 1.6;">
            üí° ÈªûÊìä <span style="font-size:16px">üîä</span> ÂúñÁ§∫ËÅÜËÅΩÁôºÈü≥<br>
            (Click the speaker icon to hear pronunciation)
        </div>
    </div>

    <div id="quiz-screen" class="quiz-area">
        <div class="stats">
            <span id="score-display">Score: 0</span>
            <span id="progress-display">Q: 1 / ‚àû</span>
        </div>

        <div class="term-container">
            <div class="term-display">
                <span id="question-term">Loading...</span>
                <button onclick="playAudio()" class="audio-btn" title="Listen">üîä</button>
            </div>
            <span id="question-ipa" class="term-ipa"></span>
        </div>

        <div id="options-container">
            </div>

        <div id="feedback-area" class="feedback">
            <h3 id="feedback-title"></h3>
            <div id="feedback-content"></div>
            
            <div id="pronunciation-box" class="pronunciation-guide hidden">
                <div class="pinyin-row">
                    <span class="pinyin-label">Á≤µ:</span>
                    <span id="canto-text"></span>
                </div>
                <div class="pinyin-row">
                    <span class="pinyin-label">ÊôÆ:</span>
                    <span id="mando-text"></span>
                </div>
            </div>
        </div>

        <button id="next-btn" class="next-btn hidden" onclick="nextQuestion()">Next Question</button>
        <button class="next-btn" style="background:#95a5a6; margin-top:20px;" onclick="location.reload()">Menu</button>
    </div>
</div>

<div class="footer-credit">
    Ë±êÁãÇÂá∫ÂìÅ ‚Ä¢ Ê®ÇÁêÜÈö®Ë∫´ËÅΩ
</div>

<script>
    // --- Data Configuration ---
    
    // Ë™ûË®Ä‰ª£Á¢ºÂ∞çÁÖßË°® (Language Mapping for SpeechSynthesis)
    const langMap = {
        "Italian": "it-IT",
        "German": "de-DE",
        "French": "fr-FR",
        "Latin": "it-IT", // Êãâ‰∏ÅÊñá‰ΩøÁî®Áæ©Â§ßÂà©ÁôºÈü≥
        "English": "en-US"
    };

    /* Data Structure:
       term: The music term (cleaned for TTS)
       displayTerm: (Optional) If you want to show abbreviations in the big question text
       ipa: IPA for the term
       def: Chinese Definition
       lang: Origin Language
       en: English Definition
       canto: Cantonese Romanization for the CHINESE definition
       mando: Mandarin Pinyin for the CHINESE definition
    */
    const musicTerms = [
        // --- Tempo / Speed ---
        { term: "langsam", ipa: "/Ààla≈ãzaÀêm/", def: "ÊÖ¢ÁöÑ", lang: "German", en: "Slow", canto: "Maan Dik", mando: "M√†n De" },
        { term: "lent", ipa: "/l…ëÃÉ/", def: "ÊÖ¢ÁöÑ", lang: "French", en: "Slow", canto: "Maan Dik", mando: "M√†n De" },
        { term: "largo", ipa: "/Ààlar.…°o/", def: "Âª£Êùø (ÂØ¨Âª£Âú∞„ÄÅÁ∑©ÊÖ¢Âú∞)", lang: "Italian", en: "Broad, slow", canto: "Gwong Baan", mando: "Gu«éng B«én" },
        { term: "lento", ipa: "/Ààl…õn.to/", def: "ÊÖ¢Êùø", lang: "Italian", en: "Slow", canto: "Maan Baan", mando: "M√†n B«én" },
        { term: "larghetto", ipa: "/larÀà…°et.to/", def: "Â∞èÂª£Êùø (ÊØî Largo Á®çÂø´)", lang: "Italian", en: "Rather broad (faster than Largo)", canto: "Siu Gwong Baan", mando: "Xi«éo Gu«éng B«én" },
        { term: "andantino", ipa: "/an.danÀàti.no/", def: "Â∞èË°åÊùø (ÊØî Andante Á®çÂø´ÊàñÁ®çÊÖ¢)", lang: "Italian", en: "Slightly faster/slower than Andante", canto: "Siu Hang Baan", mando: "Xi«éo X√≠ng B«én" },
        { term: "andante", ipa: "/anÀàdan.te/", def: "Ë°åÊùø (Ë°åËµ∞ÁöÑÂàùÂ∫¶)", lang: "Italian", en: "Walking pace", canto: "Hang Baan", mando: "X√≠ng B«én" },
        { term: "comodo", ipa: "/Ààk…î.mo.do/", def: "ËàíÈÅ©Âú∞„ÄÅËá™Âú®ÁöÑÈÄüÂ∫¶", lang: "Italian", en: "Comfortable, convenient tempo", canto: "Syv Sik Dei", mando: "Sh≈´ Sh√¨ De" },
        { term: "mod√©r√©", ipa: "/m…î.de. Åe/", def: "‰∏≠Á≠âÁöÑ„ÄÅÊúâÁØÄÂà∂ÁöÑ", lang: "French", en: "Moderate", canto: "Zung Dang", mando: "Zh≈çng Dƒõng" },
        { term: "m√§√üig", ipa: "/Ààm…õÀês…™√ß/", def: "‰∏≠Á≠âÁöÑ„ÄÅÈÅ©Â∫¶ÁöÑ (Â∏∏ÊãºÁÇ∫ m√§ssig)", lang: "German", en: "Moderate", canto: "Sik Dou", mando: "Sh√¨ D√π" },
        { term: "meno mosso", ipa: "/Ààme.no Ààm…îs.so/", def: "Á®çÊÖ¢ (Âãï‰ΩúËºÉÂ∞ë)", lang: "Italian", en: "Less movement (slower)", canto: "Siu Dung Zok", mando: "ShƒÅo M√†n" },
        { term: "retenu", ipa: "/ Å…ô.t…ô.ny/", def: "Á™ÅÊÖ¢ (Ë¢´Âãí‰Ωè)", lang: "French", en: "Held back", canto: "Dat Maan", mando: "T≈´ M√†n" },
        { term: "rubato", ipa: "/ruÀàba.to/", def: "ÂΩàÊÄßÈÄüÂ∫¶", lang: "Italian", en: "Robbed time (flexible tempo)", canto: "Taan Sing Cuk Dou", mando: "T√°n X√¨ng S√π D√π" },
        { term: "ritenuto", ipa: "/ri.teÀànu.to/", def: "Á™ÅÊÖ¢ (Á∏ÆÂØ´ rit.)", lang: "Italian", en: "Held back", canto: "Dat Maan", mando: "T≈´ M√†n" },
        { term: "rallentando", ipa: "/ral.lenÀàtan.do/", def: "Êº∏ÊÖ¢ (Á∏ÆÂØ´ rall.)", lang: "Italian", en: "Gradually slower", canto: "Zim Maan", mando: "Ji√†n M√†n" },
        { term: "ritardando", ipa: "/ri.tarÀàdan.do/", def: "Êº∏ÊÖ¢ (Á∏ÆÂØ´ rit.)", lang: "Italian", en: "Gradually slower", canto: "Zim Maan", mando: "Ji√†n M√†n" },
        { term: "a tempo", ipa: "/a Ààt…õm.po/", def: "ÂõûÂéüÈÄü", lang: "Italian", en: "Back to original speed", canto: "Wui Jyun Cuk", mando: "Hu√≠ Yu√°n S√π" },
        { term: "come prima", ipa: "/Ààko.me Ààpri.ma/", def: "Â¶ÇÂàù (ÂõûÂà∞ÊúÄÂàùÁãÄÊÖã)", lang: "Italian", en: "As before", canto: "Jyu Co", mando: "R√∫ Ch≈´" },
        { term: "alla breve", ipa: "/Ààal.la Ààbr…õ.ve/", def: "‰∫å‰∫åÊãç (‰ª•‰∫åÂàÜÈü≥Á¨¶ÁÇ∫‰∏ÄÊãç)", lang: "Italian", en: "Cut common time (2/2)", canto: "Ji Ji Paak", mando: "√àr √àr PƒÅi" },
        { term: "alla marcia", ipa: "/Ààal.la Ààmar.t Éa/", def: "ÈÄ≤Ë°åÊõ≤È¢®Ê†º", lang: "Italian", en: "In the style of a march", canto: "Zeon Hang Kuk", mando: "J√¨n X√≠ng Q«î" },
        { term: "grazioso", ipa: "/…°ratÀàtsjo.zo/", def: "ÂÑ™ÈõÖÂú∞", lang: "Italian", en: "Graceful", canto: "Jau Ngaa Dei", mando: "Y≈çu Y«é De" },
        { term: "allegretto", ipa: "/al.leÀà…°ret.to/", def: "Â∞èÂø´Êùø (ÊØî Allegro Á®çÊÖ¢)", lang: "Italian", en: "Fairly fast", canto: "Siu Faai Baan", mando: "Xi«éo Ku√†i B«én" },
        { term: "allegro", ipa: "/alÀàle.…°ro/", def: "Âø´Êùø", lang: "Italian", en: "Fast, lively", canto: "Faai Baan", mando: "Ku√†i B«én" },
        { term: "pi√π mosso", ipa: "/pju Ààm…îs.so/", def: "Á®çÂø´ (Âãï‰ΩúÊõ¥Â§ö)", lang: "Italian", en: "More movement", canto: "Saau Faai", mando: "ShƒÅo Ku√†i" },
        { term: "animato", ipa: "/a.niÀàma.to/", def: "ÁîüÂãïÂú∞„ÄÅÊ¥ªË∫çÂú∞", lang: "Italian", en: "Animated", canto: "Saang Dung", mando: "Shƒìng D√≤ng" },
        { term: "vivace", ipa: "/viÀàva.t Ée/", def: "ÁîöÂø´ / ÂÖÖÊªøÊ¥ªÂäõ", lang: "Italian", en: "Lively, quick", canto: "Sam Faai", mando: "Sh√®n Ku√†i" },
        { term: "vivo", ipa: "/Ààvi.vo/", def: "Ê¥ªÊΩëÂú∞", lang: "Italian", en: "Lively", canto: "Wut Put", mando: "Hu√≥ P≈ç" },
        { term: "stringendo", ipa: "/strinÀàd í…õn.do/", def: "Âä†Á∑ä (Êº∏Âø´)", lang: "Italian", en: "Pressing on (faster)", canto: "Gaa Gan", mando: "JiƒÅ J«ên" },
        { term: "vite", ipa: "/vit/", def: "Âø´ÈÄüÂú∞", lang: "French", en: "Fast", canto: "Faai Cuk", mando: "Ku√†i S√π" },
        { term: "schnell", ipa: "/ Én…õl/", def: "Âø´ÈÄüÂú∞", lang: "German", en: "Fast", canto: "Faai Cuk", mando: "Ku√†i S√π" },
        { term: "presto", ipa: "/Ààpr…õs.to/", def: "ÊÄ•Êùø (ÂæàÂø´)", lang: "Italian", en: "Very fast", canto: "Gap Baan", mando: "J√≠ B«én" },
        { term: "prestissimo", ipa: "/presÀàtis.si.mo/", def: "ÊúÄÊÄ•Êùø (Ê•µÂø´)", lang: "Italian", en: "As fast as possible", canto: "Zeoi Gap Baan", mando: "Zu√¨ J√≠ B«én" },
        { term: "accelerando", ipa: "/at.t Ée.leÀàran.do/", def: "Êº∏Âø´ (Á∏ÆÂØ´ accel.)", lang: "Italian", en: "Gradually faster", canto: "Zim Faai", mando: "Ji√†n Ku√†i" },
        
        // --- Navigation / Structure ---
        { term: "da capo", ipa: "/da Ààka.po/", def: "ÂæûÈ†≠ÂÜçÂ•è (Á∏ÆÂØ´ D.C.)", lang: "Italian", en: "From the beginning", canto: "Cung Tau Zau", mando: "C√≥ng T√≥u Z√≤u" },
        { term: "fine", ipa: "/Ààfi.ne/", def: "ÁµêÊùü", lang: "Italian", en: "The end", canto: "Git Cuk", mando: "Ji√© Sh√π" },
        { term: "dal segno", ipa: "/dal Ààse.…≤o/", def: "ÂæûË®òËôüËôïÂÜçÂ•è (Á∏ÆÂØ´ D.S.)", lang: "Italian", en: "From the sign", canto: "Cung Gei Hou", mando: "C√≥ng J√¨ H√†o" },
        { term: "attacca", ipa: "/atÀàtak.ka/", def: "Á∑äÊé•‰∏ãÊÆµ", lang: "Italian", en: "Go straight on", canto: "Gan Zip", mando: "J«ên Jiƒì" },
        
        // --- Articulation / Style ---
        { term: "legato", ipa: "/leÀà…°a.to/", def: "ÂúìÊªëÂ•è (ÈÄ£Â•è)", lang: "Italian", en: "Smoothly", canto: "Jyun Waat Zau", mando: "Yu√°n Hu√° Z√≤u" },
        { term: "staccato", ipa: "/stakÀàka.to/", def: "Êñ∑Â•è (Á∏ÆÂØ´ stacc.)", lang: "Italian", en: "Detached", canto: "Dyun Zau", mando: "Du√†n Z√≤u" },
        { term: "leggiero", ipa: "/ledÀàd í…õ.ro/", def: "ËºïÂ∑ßÂú∞", lang: "Italian", en: "Lightly", canto: "Hing Haau", mando: "Qƒ´ng Qi«éo" },
        { term: "marcato", ipa: "/marÀàka.to/", def: "Âä†Âº∑Èü≥ (Ê®ôÁ§∫Ê∏ÖÊô∞)", lang: "Italian", en: "Marked, accented", canto: "Gaa Koeng Jam", mando: "JiƒÅ Qi√°ng Yƒ´n" },
        { term: "prima", ipa: "/Ààpri.ma/", def: "Á¨¨‰∏Ä (Ê¨°/ÈÉ®)", lang: "Italian", en: "First", canto: "Dai Jat", mando: "D√¨ Yƒ´" },
        { term: "simile", ipa: "/Ààsi.mi.le/", def: "ÂêåÂâç (ÂêåÊ®£ÊñπÂºè)", lang: "Italian", en: "In the same way", canto: "Tung Cin", mando: "T√≥ng Qi√°n" },
        { term: "ad libitum", ipa: "/ad Ààli.bi.tum/", def: "Èö®ÊÑèÂú∞ (ÈÄüÂ∫¶/È¢®Ê†ºËá™Áî±)", lang: "Latin", en: "At choice/liberty", canto: "Ceoi Ji", mando: "Su√≠ Y√¨" },
        
        // --- Dynamics ---
        { term: "crescendo", ipa: "/kreÀà É…õn.do/", def: "Êº∏Âº∑ (Á∏ÆÂØ´ cresc.)", lang: "Italian", en: "Gradually louder", canto: "Zim Koeng", mando: "Ji√†n Qi√°ng" },
        { term: "decrescendo", ipa: "/de.kreÀà É…õn.do/", def: "Êº∏Âº± (Á∏ÆÂØ´ decresc.)", lang: "Italian", en: "Gradually softer", canto: "Zim Joek", mando: "Ji√†n Ru√≤" },
        { term: "diminuendo", ipa: "/di.mi.nuÀà…õn.do/", def: "Êº∏Âº± (Á∏ÆÂØ´ dim.)", lang: "Italian", en: "Gradually softer", canto: "Zim Joek", mando: "Ji√†n Ru√≤" },
        { term: "forte", ipa: "/Ààf…îr.te/", def: "Âº∑ (Á∏ÆÂØ´ f)", lang: "Italian", en: "Loud", canto: "Koeng", mando: "Qi√°ng" },
        { term: "fortissimo", ipa: "/forÀàtis.si.mo/", def: "ÁîöÂº∑ (Á∏ÆÂØ´ ff)", lang: "Italian", en: "Very loud", canto: "Sam Koeng", mando: "Sh√®n Qi√°ng" },
        { term: "mezzo piano", ipa: "/Ààm…õd.dzo Ààpja.no/", def: "‰∏≠Âº± (Á∏ÆÂØ´ mp)", lang: "Italian", en: "Moderately soft", canto: "Zung Joek", mando: "Zh≈çng Ru√≤" },
        { term: "piano", ipa: "/Ààpja.no/", def: "Âº± (Á∏ÆÂØ´ p)", lang: "Italian", en: "Soft", canto: "Joek", mando: "Ru√≤" },
        { term: "pianissimo", ipa: "/pjaÀànis.si.mo/", def: "ÁîöÂº± (Á∏ÆÂØ´ pp)", lang: "Italian", en: "Very soft", canto: "Sam Joek", mando: "Sh√®n Ru√≤" },
        { term: "fortepiano", ipa: "/Ààf…îr.te Ààpja.no/", def: "Âº∑ÂæåÁ™ÅÂº± (Á∏ÆÂØ´ fp)", lang: "Italian", en: "Loud then immediately soft", canto: "Koeng Hau Dat Joek", mando: "Qi√°ng H√≤u T≈´ Ru√≤" },
        { term: "sforzando", ipa: "/sforÀàtsan.do/", def: "Á™ÅÂº∑ (Âº∑Ë™øÂñÆÈü≥ sfz)", lang: "Italian", en: "Forced, accented", canto: "Dat Koeng", mando: "T≈´ Qi√°ng" },
        { term: "rinforzando", ipa: "/rin.forÀàtsan.do/", def: "Âä†Âº∑ (Á∏ÆÂØ´ rf/rfz)", lang: "Italian", en: "Reinforcing", canto: "Gaa Koeng", mando: "JiƒÅ Qi√°ng" },
        
        // --- Mood / Character ---
        { term: "cantabile", ipa: "/kanÀàta.bi.le/", def: "Â¶ÇÊ≠åÂú∞", lang: "Italian", en: "Singing style", canto: "Jyu Go Dei", mando: "R√∫ Gƒì De" },
        { term: "dolce", ipa: "/Ààdol.t Ée/", def: "ÁîúÁæéÂú∞„ÄÅÊ∫´ÊüîÂú∞", lang: "Italian", en: "Sweet, soft", canto: "Tim Mei", mando: "Ti√°n Mƒõi" },
        { term: "espressivo", ipa: "/es.presÀàsi.vo/", def: "ÂØåÊúâË°®ÊÉÖÂú∞", lang: "Italian", en: "Expressive", canto: "Fu Jau Biu Cing", mando: "F√π Y«íu Bi«éo Q√≠ng" },
        { term: "con forza", ipa: "/kon Ààf…îr.tsa/", def: "ÊúâÂäõÂú∞", lang: "Italian", en: "With force", canto: "Jau Lik", mando: "Y«íu L√¨" },
        { term: "energico", ipa: "/eÀàn…õr.d íi.ko/", def: "Á≤æÂäõÂÖÖÊ≤õÂú∞", lang: "Italian", en: "Energetic", canto: "Zing Lik Cung Pui", mando: "Jƒ´ng L√¨ Ch≈çng P√®i" },
        { term: "giocoso", ipa: "/d íoÀàko.zo/", def: "Ë©ºË´ßÂú∞„ÄÅÂø´Ê®ÇÂú∞", lang: "Italian", en: "Playful, merry", canto: "Fui Haai", mando: "Huƒ´ Xi√©" },
        { term: "scherzando", ipa: "/skerÀàtsan.do/", def: "Êà≤Ë¨îÂú∞„ÄÅÈñãÁé©Á¨ëÂú∞", lang: "Italian", en: "Playful, joking", canto: "Hei Joek", mando: "X√¨ Nu√®" },
        { term: "semplice", ipa: "/Ààs…õm.pli.t Ée/", def: "ÂñÆÁ¥îÂú∞„ÄÅÊ®∏Á¥†Âú∞", lang: "Italian", en: "Simple, plain", canto: "Daan Seon", mando: "DƒÅn Ch√∫n" },
        { term: "sostenuto", ipa: "/so.steÀànu.to/", def: "ÊåÅÁ∫åÂú∞ (Èü≥Ë¶ÅÊãñÈï∑)", lang: "Italian", en: "Sustained", canto: "Ci Zuk", mando: "Ch√≠ X√π" },
        { term: "subito", ipa: "/Ààsu.bi.to/", def: "Á™ÅÁÑ∂Âú∞", lang: "Italian", en: "Suddenly", canto: "Dat Yin", mando: "T≈´ R√°n" },
        { term: "tranquillo", ipa: "/tranÀàkwil.lo/", def: "Âπ≥ÈùúÂú∞", lang: "Italian", en: "Calm", canto: "Ping Zing", mando: "P√≠ng J√¨ng" },
        { term: "triste", ipa: "/Ààtri.ste/", def: "ÊÇ≤ÂÇ∑Âú∞", lang: "Italian", en: "Sad", canto: "Bei Soeng", mando: "Bƒìi ShƒÅng" },
        { term: "affettuoso", ipa: "/af.fetÀàtwo.zo/", def: "Ê∑±ÊÉÖÂú∞", lang: "Italian", en: "Affectionate", canto: "Sam Cing", mando: "Shƒìn Q√≠ng" },
        { term: "amabile", ipa: "/aÀàma.bi.le/", def: "ÂèØÊÑõÂú∞„ÄÅË¶™ÂàáÂú∞", lang: "Italian", en: "Amiable", canto: "Ho Oi", mando: "Kƒõ √Äi" },
        { term: "appassionato", ipa: "/ap.pas.sjoÀàna.to/", def: "ÁÜ±ÊÉÖÂú∞", lang: "Italian", en: "Passionate", canto: "Jit Cing", mando: "R√® Q√≠ng" },
        { term: "con brio", ipa: "/kon Ààbri.o/", def: "ÊúâÊ¥ªÂäõÂú∞„ÄÅËºùÁÖåÂú∞", lang: "Italian", en: "With vigour", canto: "Jau Wut Lik", mando: "Y«íu Hu√≥ L√¨" },
        { term: "deciso", ipa: "/deÀàt Éi.zo/", def: "Â†ÖÂÆöÂú∞", lang: "Italian", en: "With determination", canto: "Gin Ding", mando: "JiƒÅn D√¨ng" },
        { term: "mesto", ipa: "/Ààm…õ.sto/", def: "ÊÜÇÈ¨±Âú∞„ÄÅÊÇ≤ÂÇ∑Âú∞", lang: "Italian", en: "Sad, mournful", canto: "Jau Wat", mando: "Y≈çu Y√π" },
        { term: "misterioso", ipa: "/mi.steÀàrjo.zo/", def: "Á•ûÁßòÂú∞", lang: "Italian", en: "Mysterious", canto: "San Bei", mando: "Sh√©n M√¨" },
        { term: "anim√©", ipa: "/a.ni.me/", def: "Ê¥ªË∫çÁöÑ", lang: "French", en: "Animated", canto: "Wut Joek", mando: "Hu√≥ Yu√®" },
        { term: "douce", ipa: "/dus/", def: "ÁîúÁæéÁöÑ„ÄÅÊ∫´ÊüîÁöÑ", lang: "French", en: "Sweet", canto: "Tim Mei", mando: "Ti√°n Mƒõi" },
        { term: "lebhaft", ipa: "/ÀàleÀêphaft/", def: "Ê¥ªÊΩëÁöÑ", lang: "German", en: "Lively", canto: "Wut Put", mando: "Hu√≥ P≈ç" },
        { term: "ruhig", ipa: "/ÀàruÀê…™√ß/", def: "Âπ≥ÈùúÁöÑ", lang: "German", en: "Peaceful", canto: "Ping Zing", mando: "P√≠ng J√¨ng" },
        { term: "traurig", ipa: "/Ààt Åa äÃØ Å…™√ß/", def: "ÊÇ≤ÂÇ∑ÁöÑ", lang: "German", en: "Sad", canto: "Bei Soeng", mando: "Bƒìi ShƒÅng" },
        { term: "morendo", ipa: "/moÀàr…õn.do/", def: "Êº∏Âº±Ê∂àÂ§± (ÂûÇÊ≠ªÁãÄ)", lang: "Italian", en: "Dying away", canto: "Zim Joek Siu Sat", mando: "Ji√†n Ru√≤ XiƒÅo Shƒ´" },
        { term: "perdendosi", ipa: "/perÀàd…õn.do.si/", def: "ÈÄêÊº∏Ê∂àÂ§±", lang: "Italian", en: "Dying away", canto: "Zuk Zim Siu Sat", mando: "Zh√∫ Ji√†n XiƒÅo Shƒ´" },
        { term: "smorzando", ipa: "/zmorÀàtsan.do/", def: "Êº∏ÊÖ¢‰∏îÊº∏Âº± (ÁÜÑÊªÖ)", lang: "Italian", en: "Dying away", canto: "Zim Maan Zim Joek", mando: "Ji√†n M√†n Ji√†n Ru√≤" },
        { term: "sotto voce", ipa: "/Ààsot.to Ààvo.t Ée/", def: "‰ΩéËÅ≤Âú∞ (ÂçäËÅ≤)", lang: "Italian", en: "In an undertone", canto: "Dai Sing", mando: "Dƒ´ Shƒìng" },
        
        // --- Conjunctions / Modifiers ---
        { term: "con", ipa: "/kon/", def: "Áî®„ÄÅ‰º¥Èö®Ëëó", lang: "Italian", en: "With", canto: "Jung", mando: "Y√≤ng" },
        { term: "ma", ipa: "/ma/", def: "‰ΩÜÊòØ", lang: "Italian", en: "But", canto: "Daan Si", mando: "D√†n Sh√¨" },
        { term: "meno", ipa: "/Ààme.no/", def: "ËºÉÂ∞ë", lang: "Italian", en: "Less", canto: "Gaau Siu", mando: "Ji√†o Sh«éo" },
        { term: "molto", ipa: "/Ààmol.to/", def: "Âæà„ÄÅÁîö", lang: "Italian", en: "Very", canto: "Han", mando: "Hƒõn" },
        { term: "non", ipa: "/non/", def: "‰∏ç", lang: "Italian", en: "Not", canto: "Bat", mando: "B√π" },
        { term: "troppo", ipa: "/Ààtr…îp.po/", def: "Â§™„ÄÅÈÅéÂ§ö", lang: "Italian", en: "Too much", canto: "Taai", mando: "T√†i" },
        { term: "pi√π", ipa: "/pju/", def: "Êõ¥Â§ö", lang: "Italian", en: "More", canto: "Gang Do", mando: "G√®ng Du≈ç" },
        { term: "poco", ipa: "/Ààp…î.ko/", def: "‰∏ÄÈªûÈªû", lang: "Italian", en: "A little", canto: "Jat Dim Dim", mando: "Yƒ´ Di«én Di«én" },
        { term: "assai", ipa: "/asÀàsai/", def: "ÈùûÂ∏∏ (ÊúâÊôÇÊåáÈÅ©Â∫¶)", lang: "Italian", en: "Very", canto: "Fei Soeng", mando: "Fƒìi Ch√°ng" },
        { term: "quasi", ipa: "/Ààkwa.zi/", def: "Âπæ‰πé„ÄÅÈ°û‰ºº", lang: "Italian", en: "As if", canto: "Gei Fu", mando: "Jƒ´ H≈´" },
        { term: "sempre", ipa: "/Ààs…õm.pre/", def: "ÂßãÁµÇ„ÄÅ‰∏ÄÁõ¥", lang: "Italian", en: "Always", canto: "Ci Zung", mando: "Sh«ê Zh≈çng" },
        { term: "senza", ipa: "/Ààs…õn.tsa/", def: "Ê≤íÊúâ", lang: "Italian", en: "Without", canto: "Mut Jau", mando: "M√©i Y«íu" },
        { term: "ben", ipa: "/b…õn/", def: "ÂÖÖÂàÜÂú∞„ÄÅÂæàÂ•ΩÂú∞", lang: "Italian", en: "Well", canto: "Cung Fan", mando: "Ch≈çng F√®n" },
        
        // --- Additional Terms from list ---
        { term: "grave", ipa: "/Àà…°ra.ve/", def: "ËéäÊùø (Ê•µÁ∑©ÊÖ¢ËéäÂö¥)", lang: "Italian", en: "Very slow, solemn", canto: "Zong Baan", mando: "ZhuƒÅng B«én" },
        { term: "allargando", ipa: "/al.larÀà…°an.do/", def: "Êº∏ÂØ¨Âª£ (Êº∏ÊÖ¢‰∏îÂº∑)", lang: "Italian", en: "Broadening", canto: "Zim Fun Gwong", mando: "Ji√†n KuƒÅn Gu«éng" },
        { term: "con moto", ipa: "/kon Ààm…î.to/", def: "ÊúâÂãïÊÑüÂú∞", lang: "Italian", en: "With movement", canto: "Jau Dung Gam", mando: "Y«íu D√≤ng G«én" },
        { term: "agitato", ipa: "/a.d íiÀàta.to/", def: "ÊøÄÂãïÂú∞", lang: "Italian", en: "Agitated", canto: "Gik Dung", mando: "Jƒ´ D√≤ng" },
        { term: "maestoso", ipa: "/ma.eÀàsto.zo/", def: "ËéäÂö¥Âú∞", lang: "Italian", en: "Majestic", canto: "Zong Jim", mando: "ZhuƒÅng Y√°n" },
        { term: "pesante", ipa: "/peÀàzan.te/", def: "Ê≤àÈáçÂú∞", lang: "Italian", en: "Heavy", canto: "Cam Zung", mando: "Ch√©n Zh√≤ng" },
        { term: "risoluto", ipa: "/ri.zoÀàlu.to/", def: "ÊûúÊñ∑Âú∞", lang: "Italian", en: "Bold, strong", canto: "Gwo Dyun", mando: "Gu«í Du√†n" },
        { term: "ritmico", ipa: "/Ààrit.mi.ko/", def: "ÊúâÁØÄÂ•èÂú∞", lang: "Italian", en: "Rhythmic", canto: "Jau Zit Zau", mando: "Y«íu Ji√© Z√≤u" },
        { term: "cantando", ipa: "/kanÀàtan.do/", def: "Ê≠åÂî±Ëà¨Âú∞", lang: "Italian", en: "Singing", canto: "Go Coeng Bun", mando: "Gƒì Ch√†ng BƒÅn" },
        { term: "con dolore", ipa: "/kon doÀàlo.re/", def: "ÊÇ≤ÁóõÂú∞", lang: "Italian", en: "With grief", canto: "Bei Tung", mando: "Bƒìi T√≤ng" },
        { term: "con spirito", ipa: "/kon Ààspi.ri.to/", def: "ÊúâÁ≤æÁ•ûÂú∞", lang: "Italian", en: "With spirit", canto: "Jau Zing San", mando: "Y«íu Jƒ´ng Sh√©n" },
        { term: "doloroso", ipa: "/do.loÀàro.zo/", def: "ÁóõËã¶Âú∞", lang: "Italian", en: "Sorrowful", canto: "Tung Fu", mando: "T√≤ng K«î" },
        { term: "largamente", ipa: "/lar.…°aÀàmen.te/", def: "ÂØ¨Âª£Âú∞", lang: "Italian", en: "Broadly", canto: "Fun Gwong", mando: "KuƒÅn Gu«éng" },
        { term: "sonoro", ipa: "/soÀàn…î.ro/", def: "Èüø‰∫ÆÂú∞", lang: "Italian", en: "Resonant", canto: "Hoeng Loeng", mando: "Xi«éng Li√†ng" },
        { term: "a niente", ipa: "/a Àànj…õn.te/", def: "Êº∏Âº±Ëá≥ÁÑ°ËÅ≤", lang: "Italian", en: "To nothing", canto: "Zi Mou Sing", mando: "Zh√¨ W√∫ Shƒìng" }
    ];

    let currentMode = 'zh'; 
    let currentQuestion = null;
    let score = 0;
    let questionCount = 0;
    let isAnswering = true;

    function startQuiz(mode) {
        currentMode = mode;
        document.getElementById('start-screen').style.display = 'none';
        document.getElementById('quiz-screen').style.display = 'block';
        nextQuestion();
    }

    function getRandomItem(array) {
        return array[Math.floor(Math.random() * array.length)];
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function generateOptions(correctItem) {
        const options = [correctItem];
        while (options.length < 4) {
            const randomItem = getRandomItem(musicTerms);
            if (!options.includes(randomItem)) {
                options.push(randomItem);
            }
        }
        shuffleArray(options);
        return options;
    }

    // --- Audio Logic ---
    function playAudio() {
        if (!currentQuestion) return;

        // Use the main term for TTS (Google TTS works best with just the word)
        // Clean up brackets for TTS (e.g., "ritenuto" instead of "ritenuto (rit.)")
        let textToSpeak = currentQuestion.term;
        
        const langName = currentQuestion.lang; 
        const langCode = langMap[langName] || "en-US"; 

        if ('speechSynthesis' in window) {
            window.speechSynthesis.cancel();
            const utterance = new SpeechSynthesisUtterance(textToSpeak);
            utterance.lang = langCode;
            utterance.rate = 0.8; 
            window.speechSynthesis.speak(utterance);
        } else {
            const encodedTerm = encodeURIComponent(textToSpeak);
            const url = `https://translate.google.com/?sl=auto&text=${encodedTerm}&op=translate`;
            window.open(url, 'googleTranslate', 'width=450,height=550,top=100,left=100,scrollbars=yes');
        }
    }

    function nextQuestion() {
        isAnswering = true;
        questionCount++;
        document.getElementById('progress-display').textContent = `Q: ${questionCount}`;
        
        // Reset UI
        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('feedback-area').className = 'feedback';
        document.getElementById('feedback-area').style.display = 'none';
        document.getElementById('pronunciation-box').classList.add('hidden');
        
        // Select Question
        currentQuestion = getRandomItem(musicTerms);
        const options = generateOptions(currentQuestion);

        // Render Question
        // Use capitalization for the question display
        const displayTerm = currentQuestion.term.charAt(0).toUpperCase() + currentQuestion.term.slice(1);
        document.getElementById('question-term').textContent = displayTerm;
        
        // Render IPA if available
        const ipaEl = document.getElementById('question-ipa');
        ipaEl.textContent = currentQuestion.ipa ? `[ ${currentQuestion.ipa} ]` : '';

        // Render Options
        const optionsContainer = document.getElementById('options-container');
        optionsContainer.innerHTML = '';

        options.forEach(opt => {
            const btn = document.createElement('button');
            btn.className = 'option-btn';
            
            if (currentMode === 'zh') {
                btn.textContent = opt.def;
            } else {
                btn.textContent = opt.en;
            }

            btn.onclick = () => checkAnswer(opt, btn);
            optionsContainer.appendChild(btn);
        });
    }

    function checkAnswer(selectedOption, btnElement) {
        if (!isAnswering) return;
        isAnswering = false;

        const isCorrect = selectedOption.term === currentQuestion.term;
        const feedbackArea = document.getElementById('feedback-area');
        const feedbackTitle = document.getElementById('feedback-title');
        const feedbackContent = document.getElementById('feedback-content');

        const allBtns = document.querySelectorAll('.option-btn');
        allBtns.forEach(btn => {
            if ((currentMode === 'zh' && btn.textContent === currentQuestion.def) ||
                (currentMode === 'en' && btn.textContent === currentQuestion.en)) {
                btn.classList.add('correct');
            } else {
                btn.disabled = true;
            }
        });

        if (isCorrect) {
            score++;
            document.getElementById('score-display').textContent = `Score: ${score}`;
            btnElement.classList.add('correct');
            feedbackArea.classList.add('success');
            feedbackTitle.textContent = "Correct! Á≠îÂ∞ç‰∫ÜÔºÅ";
            feedbackTitle.style.color = "#2ECC71";
            // playAudio(); // Optional: Auto-play audio on correct answer
        } else {
            btnElement.classList.add('wrong');
            feedbackArea.classList.add('error');
            feedbackTitle.textContent = "Incorrect Á≠îÈåØ‰∫Ü";
            feedbackTitle.style.color = "#E74C3C";
        }

        feedbackContent.innerHTML = `
            <div style="font-size:1.1em; margin-bottom:5px;"><strong>${currentQuestion.term}</strong> (${currentQuestion.lang})</div>
            <div style="color:#555;">${currentQuestion.def}</div>
            <div style="color:#777; font-size:0.9em;">English: ${currentQuestion.en}</div>
        `;
        
        // Show Pronunciation Guide ONLY in Chinese Mode
        if(currentMode === 'zh') {
            const pBox = document.getElementById('pronunciation-box');
            const cText = document.getElementById('canto-text');
            const mText = document.getElementById('mando-text');
            
            if(currentQuestion.canto || currentQuestion.mando) {
                pBox.classList.remove('hidden');
                cText.textContent = currentQuestion.canto || '-';
                mText.textContent = currentQuestion.mando || '-';
            }
        }

        feedbackArea.style.display = 'block';
        document.getElementById('next-btn').classList.remove('hidden');
    }
</script>

</body>
</html>
